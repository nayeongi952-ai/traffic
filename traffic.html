<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Realistic KR Traffic Light</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: linear-gradient(#87ceeb, #bfe3ff);
      background-size: cover;
      font-family: -apple-system, system-ui, sans-serif;
      user-select: none;
      overflow-x: hidden;
    }

    /* êµ¬ë¦„ ë ˆì´ì–´ */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("https://png.pngtree.com/png-vector/20230926/ourmid/pngtree-pure-clouds-in-blue-sky-png-image_10151641.png");
      background-size: cover;
      opacity: 0.22;
      pointer-events: none;
    }

    .wrap {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      box-sizing: border-box;
    }

    /* ==========================
          ğŸš¦ Aí˜• ê°€ë¡œ ì‹ í˜¸ë“±
       ========================== */

    .traffic-rig {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    /* ê°€ë¡œí˜• ë³¸ì²´ */
    .signal-case {
      width: min(90vw, 420px);
      height: min(32vh, 180px);
      background: #2b2f35;
      border-radius: 28px;
      border: 10px solid #16181c;
      box-shadow:
        0 8px 26px rgba(0,0,0,0.65),
        inset 0 0 18px rgba(0,0,0,0.9);
      display: flex;
      justify-content: space-around;
      align-items: center;
      position: relative;
    }

    /* ë³¸ì²´ ì˜†ë©´ ì‚´ì§ ëŒì¶œ */
    .signal-case::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 20px;
      border: 2px solid rgba(255,255,255,0.04);
    }

    /* ê° ë“± ìœ ë‹›(ë…¸ë€ ë°•ìŠ¤) */
    .lamp-unit {
      position: relative;
      width: 30%;
      max-width: 130px;
      aspect-ratio: 1/1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* ìƒë‹¨ ì°¨ì–‘(ê°“) â€“ Aí˜• ìŠ¤íƒ€ì¼ */
    .lamp-unit::before {
      content: "";
      position: absolute;
      top: -26%;
      left: 8%;
      right: 8%;
      height: 35%;
      background: #15181b;
      border-radius: 14px 14px 6px 6px;
      box-shadow:
        0 4px 10px rgba(0,0,0,0.7),
        inset 0 -2px 6px rgba(0,0,0,0.8);
    }

    /* ëª¨ì„œë¦¬ ë³¼íŠ¸ */
    .bolt {
      position: absolute;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #555;
      box-shadow: 0 0 2px #000;
    }
    .bolt.tl { top: 6px;  left: 6px;  }
    .bolt.tr { top: 6px;  right: 6px; }
    .bolt.bl { bottom: 6px; left: 6px; }
    .bolt.br { bottom: 6px; right: 6px; }

    /* ì›í˜• ë Œì¦ˆ ê³µí†µ */
    .lamp {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #151515;
      box-shadow:
        inset 0 0 40px rgba(0,0,0,0.9);
      position: relative;
      overflow: hidden;
      transition: 0.25s;
    }

    /* ë Œì¦ˆ ê²©ìë¬´ëŠ¬ (í…ìŠ¤ì²˜) */
    .lamp::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 0 0, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.02) 40%, transparent 60%),
        repeating-radial-gradient(circle, rgba(0,0,0,0.25) 0 1px, transparent 1px 3px);
      mix-blend-mode: screen;
      opacity: 0.8;
    }

    /* ë¹¨ê°„ë¶ˆ ì¼œì§ */
    .lamp.red.on {
      background:
        radial-gradient(circle at 30% 25%, #ffe0e0, #ff4a4a 45%, #7a0000 80%);
      box-shadow:
        0 0 26px #ff3b30,
        inset 0 0 40px rgba(0,0,0,0.9);
    }

    /* ë…¸ë€ë¶ˆ (í•­ìƒ off / ëª¨ì–‘ë§Œ ì¡´ì¬) */
    .lamp.yellow {
      background:
        radial-gradient(circle at 30% 25%, #55552a, #2f2f15 70%);
    }

    /* ì´ˆë¡ë¶ˆ ì¼œì§ */
    .lamp.green.on {
      background:
        radial-gradient(circle at 30% 25%, #e0ffe9, #3cff7a 45%, #006b34 80%);
      box-shadow:
        0 0 26px #34c759,
        inset 0 0 40px rgba(0,0,0,0.9);
    }

    /* ê¸°ë‘¥ + ì§€ì§€ëŒ€ : ê°ì²´ì¸ì‹ìš©ìœ¼ë¡œ ì•„ë˜ê¹Œì§€ ê½‰ ì±„ì›€ */
    .mast {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 8px;
    }

    .pole {
      width: 32px;
      height: 220px;
      background: linear-gradient(to right,#222,#555,#222);
      border-radius: 18px;
      box-shadow:
        inset 0 0 18px #111,
        0 6px 16px rgba(0,0,0,0.7);
    }

    .pole-base {
      width: 110px;
      height: 30px;
      margin-top: -2px;
      background: #333;
      border-radius: 14px;
      box-shadow:
        inset 0 0 18px #111,
        0 4px 10px rgba(0,0,0,0.7);
    }

    /* ======================
         ì œì–´ UI
       ====================== */
    .ctrl {
      width: 100%;
      max-width: 500px;
    }
    .btns {
      display: grid;
      gap: 18px;
      margin-top: 20px;
    }
    button {
      padding: 18px;
      font-size: 1.4rem;
      border: none;
      border-radius: 16px;
      color: #fff;
      background: #444;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    .b-red   { background:#e53935; }
    .b-green { background:#2ecc71; }

    .pill {
      background:#0008;
      padding: 10px 14px;
      border-radius: 12px;
      display:inline-block;
      margin-top:12px;
      color:#fff;
    }
  </style>

  <!-- ============================
        Firebase + ì œì–´ ë¡œì§
       ============================ -->
  <script type="module">
    import { initializeApp }   from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // ë„¤ê°€ ì¤€ Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyClsKru0-dRRl8ErV5vQx2vS31JFIV_OKM",
      authDomain: "traffic-light-demo-c070a.firebaseapp.com",
      databaseURL: "https://traffic-light-demo-c070a-default-rtdb.firebaseio.com",
      projectId: "traffic-light-demo-c070a",
      storageBucket: "traffic-light-demo-c070a.firebasestorage.app",
      messagingSenderId: "272853805092",
      appId: "1:272853805092:web:e95b87c470419a90d290b1",
      measurementId: "G-ZHQXT1WE0F"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);
    const colorRef = ref(db, "tl/color");

    const params = new URLSearchParams(location.search);
    const mode   = params.get("mode") || "display";

    async function setColor(c){
      await set(colorRef, c);           // "red" ë˜ëŠ” "green"ë§Œ ì‚¬ìš©
    }

    async function ensureInit(){
      const snap = await get(child(ref(db),"tl/color"));
      if(!snap.exists()) await setColor("red");
    }

    /* ===== ì‹ í˜¸ë“± í™”ë©´ ===== */
    function displayUI(){
      document.querySelector(".wrap").innerHTML = `
        <div class="traffic-rig">
          <div class="signal-case">
            <!-- ë¹¨ê°„ë¶ˆ -->
            <div class="lamp-unit">
              <div class="lamp red" id="RED"></div>
              <div class="bolt tl"></div><div class="bolt tr"></div>
              <div class="bolt bl"></div><div class="bolt br"></div>
            </div>
            <!-- ë…¸ë€ë¶ˆ (í˜•íƒœë§Œ, í•­ìƒ off) -->
            <div class="lamp-unit">
              <div class="lamp yellow" id="YEL"></div>
              <div class="bolt tl"></div><div class="bolt tr"></div>
              <div class="bolt bl"></div><div class="bolt br"></div>
            </div>
            <!-- ì´ˆë¡ë¶ˆ -->
            <div class="lamp-unit">
              <div class="lamp green" id="GRN"></div>
              <div class="bolt tl"></div><div class="bolt tr"></div>
              <div class="bolt bl"></div><div class="bolt br"></div>
            </div>
          </div>

          <div class="mast">
            <div class="pole"></div>
            <div class="pole-base"></div>
          </div>
        </div>
      `;

      onValue(colorRef, (snap)=>{
        const c = snap.val() || "red";
        // ë¹¨ê°•/ì´ˆë¡ë§Œ ìƒíƒœ ë³€ê²½, ë…¸ë€ë¶ˆì€ í•­ìƒ off ëª¨ì–‘ ìœ ì§€
        RED.classList.toggle("on",  c === "red");
        GRN.classList.toggle("on",  c === "green");
      });
    }

    /* ===== ì œì–´ í™”ë©´ ===== */
    function controlUI(){
      document.querySelector(".wrap").innerHTML = `
        <div class="ctrl">
          <h2>ì‹ í˜¸ë“± ì œì–´</h2>
          <div class="btns">
            <button class="b-red"   id="BRED">ğŸ”´ ë¹¨ê°„ë¶ˆ</button>
            <button class="b-green" id="BGREEN">ğŸŸ¢ ì´ˆë¡ë¶ˆ</button>
          </div>
          <div class="pill" id="current">í˜„ì¬: ë¡œë”©ì¤‘...</div>
          <br><br>
          <a href="?mode=display" target="_blank">ì‹ í˜¸ë“± í™”ë©´ ì—´ê¸°</a>
        </div>
      `;

      BRED.onclick   = ()=>setColor("red");
      BGREEN.onclick = ()=>setColor("green");

      onValue(colorRef, (snap)=>{
        current.textContent = "í˜„ì¬: " + (snap.val() || "red");
      });
    }

    (async ()=>{
      await ensureInit();
      if(mode === "control") controlUI();
      else displayUI();
    })();
  </script>
</head>

<body>
  <div class="wrap"><div>ë¡œë”©ì¤‘â€¦</div></div>
</body>
</html>
