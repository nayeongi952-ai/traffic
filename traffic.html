<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Traffic Light Realistic</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: linear-gradient(#87ceeb, #bfe3ff);
      background-size: cover;
      font-family: -apple-system, system-ui, sans-serif;
      user-select: none;
      overflow-x: hidden;
    }

    /* Íµ¨Î¶Ñ Î†àÏù¥Ïñ¥ */
    body::before {
      content: "";
      position: fixed;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: url("https://png.pngtree.com/png-vector/20230926/ourmid/pngtree-pure-clouds-in-blue-sky-png-image_10151641.png");
      background-size: cover;
      opacity: 0.25;
      pointer-events: none;
    }

    .wrap {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 30px;
    }

    /* ==========================
         ‚ú¶ ÌòÑÏã§ Ïã†Ìò∏Îì± Ïä§ÌÉÄÏùº ‚ú¶
       ========================== */

    .traffic-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Ïã†Ìò∏Îì± Î≥∏Ï≤¥ */
    .traffic-body {
      width: 170px;
      background: #222;
      border-radius: 25px;
      padding: 20px 12px;
      border: 9px solid #111;
      box-shadow: 0 10px 35px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      gap: 30px;
      position: relative;
      z-index: 10;
    }

    /* Îû®ÌîÑÍ∞Ä Îì§Ïñ¥Í∞ÄÎäî Î∞ïÏä§ */
    .lamp-box {
      width: 100%;
      height: 140px;
      background: #1a1a1a;
      border-radius: 25px;
      border: 8px solid #000;
      box-shadow: inset 0 0 25px rgba(0,0,0,0.7);
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Ï∏°Î©¥ ÌõÑÎìú(Í∞ì) */
    .hood {
      position: absolute;
      width: 28px;
      height: 70%;
      background: #000;
      top: 15%;
      border-radius: 15px;
      box-shadow: inset -4px 0 10px rgba(0,0,0,0.7);
    }

    .hood-left  { left: -22px; transform: skewY(8deg); }
    .hood-right { right: -22px; transform: skewY(-8deg); }

    /* ======================================
               ‚ú¶ Ïã†Ìò∏Îì± Îû®ÌîÑ (Î∂à) ‚ú¶
       ====================================== */

    .lamp {
      width: 95px;
      height: 95px;
      border-radius: 50%;
      background: #222;
      box-shadow: inset 0 0 35px rgba(0,0,0,0.85);
      transition: 0.2s;
    }

    /* Îπ®Í∞ÑÎ∂à ÏºúÏßê */
    .lamp.red.on {
      background: radial-gradient(circle at 30% 30%, #ffbbbb, #ff0000 60%, #550000 90%);
      box-shadow: 0 0 25px #ff0000, inset 0 0 25px rgba(0,0,0,0.9);
    }

    /* Ï¥àÎ°ùÎ∂à ÏºúÏßê */
    .lamp.green.on {
      background: radial-gradient(circle at 30% 30%, #bbffcc, #00cc55 60%, #004422 90%);
      box-shadow: 0 0 25px #00cc55, inset 0 0 25px rgba(0,0,0,0.9);
    }

    /* ======================================
                 ‚ú¶ Í∏∞Îë• + Î∞îÎã• ‚ú¶
       ====================================== */

    .pole {
      width: 26px;
      height: 250px; /* ‚úî ÎÑà ÏöîÏ≤≠ÎåÄÎ°ú Í∏∏Í≤å */
      background: #444;
      margin-top: 5px;
      border-radius: 12px;
      box-shadow: inset 0 0 20px #222;
    }

    /* Î∞îÎã• Î∞õÏπ®ÎåÄ */
    .pole-base {
      width: 90px;
      height: 25px;
      background: #333;
      margin-top: -2px;
      border-radius: 12px;
      box-shadow: inset 0 0 20px #111;
    }

    /* ======================
         ‚ú¶ Ï†úÏñ¥ UI ‚ú¶
       ====================== */

    .ctrl { width: 100%; max-width: 500px; }
    .btns { display: grid; gap: 20px; margin-top: 20px; }

    button {
      padding: 18px;
      font-size: 1.4rem;
      border: none;
      border-radius: 16px;
      color: white;
      background: #444;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    .b-red { background: #e53935; }
    .b-green { background: #2ecc71; }

    .pill {
      background: #0008;
      padding: 10px 14px;
      border-radius: 12px;
      display: inline-block;
      margin-top: 12px;
      color: #fff;
    }
  </style>

  <!-- =========================================
                Firebase + Ï†úÏñ¥ Î°úÏßÅ
       ========================================= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    /* ‚ñº ÎÑàÍ∞Ä Ï§Ä firebaseConfig Í∑∏ÎåÄÎ°ú ÎÑ£Ïùå */
    const firebaseConfig = {
      apiKey: "AIzaSyClsKru0-dRRl8ErV5vQx2vS31JFIV_OKM",
      authDomain: "traffic-light-demo-c070a.firebaseapp.com",
      databaseURL: "https://traffic-light-demo-c070a-default-rtdb.firebaseio.com",
      projectId: "traffic-light-demo-c070a",
      storageBucket: "traffic-light-demo-c070a.firebasestorage.app",
      messagingSenderId: "272853805092",
      appId: "1:272853805092:web:e95b87c470419a90d290b1",
      measurementId: "G-ZHQXT1WE0F"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);
    const colorRef = ref(db, "tl/color");

    const params = new URLSearchParams(location.search);
    const mode   = params.get("mode") || "display";

    async function setColor(c){
      await set(colorRef, c);
    }

    async function ensureInit(){
      const snap = await get(child(ref(db), "tl/color"));
      if(!snap.exists()) await setColor("red");
    }

    /* ===========================
         Ïã†Ìò∏Îì± ÌôîÎ©¥ (display)
       =========================== */
    function displayUI(){
      document.querySelector(".wrap").innerHTML = `
        <div class="traffic-container">
          <div class="traffic-body">

            <!-- Îπ®Í∞ÑÎ∂à -->
            <div class="lamp-box">
              <div class="lamp red" id="RED"></div>
              <div class="hood hood-left"></div>
              <div class="hood hood-right"></div>
            </div>

            <!-- Ï¥àÎ°ùÎ∂à -->
            <div class="lamp-box">
              <div class="lamp green" id="GRN"></div>
              <div class="hood hood-left"></div>
              <div class="hood hood-right"></div>
            </div>

          </div>

          <div class="pole"></div>
          <div class="pole-base"></div>
        </div>
      `;

      onValue(colorRef, (snap)=>{
        const c = snap.val() || "red";
        RED.classList.toggle("on",  c === "red");
        GRN.classList.toggle("on", c === "green");
      });
    }

    /* ===========================
         Ï†úÏñ¥ ÌôîÎ©¥ (control)
       =========================== */
    function controlUI(){
      document.querySelector(".wrap").innerHTML = `
        <div class="ctrl">
          <h2>Ïã†Ìò∏Îì± Ï†úÏñ¥</h2>

          <div class="btns">
            <button class="b-red"   id="BRED">üî¥ Îπ®Í∞ÑÎ∂à</button>
            <button class="b-green" id="BGREEN">üü¢ Ï¥àÎ°ùÎ∂à</button>
          </div>

          <div class="pill" id="current">ÌòÑÏû¨: Î°úÎî©Ï§ë...</div>
          <br><br>
          <a href="?mode=display" target="_blank">Ïã†Ìò∏Îì± ÌôîÎ©¥ Ïó¥Í∏∞</a>
        </div>
      `;

      BRED.onclick   = ()=>setColor("red");
      BGREEN.onclick = ()=>setColor("green");

      onValue(colorRef, (snap)=>{
        current.textContent = "ÌòÑÏû¨: " + (snap.val() || "red");
      });
    }

    (async()=>{
      await ensureInit();
      if(mode === "control") controlUI();
      else displayUI();
    })();
  </script>

</head>

<body>
  <div class="wrap"><div>Î°úÎî©Ï§ë‚Ä¶</div></div>
</body>
</html>

