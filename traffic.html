<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Vertical KR Traffic Light</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: linear-gradient(#87ceeb, #bfe3ff);
      background-size: cover;
      font-family: -apple-system, system-ui, sans-serif;
      user-select: none;
    }

    /* Íµ¨Î¶Ñ Î∞∞Í≤Ω */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("https://png.pngtree.com/png-vector/20230926/ourmid/pngtree-pure-clouds-in-blue-sky-png-image_10151641.png");
      background-size: cover;
      opacity: 0.22;
      pointer-events: none;
    }

    .wrap {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 30px;
    }

    /* ==========================
         üö¶ ÏÑ∏Î°úÌòï Ïã†Ìò∏Îì± Î≥∏Ï≤¥
       ========================== */

    .traffic-vertical {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .signal-box {
      width: 180px;
      background: #2b2f35;
      border-radius: 28px;
      border: 10px solid #16181c;
      padding: 20px 10px;
      display: flex;
      flex-direction: column;
      gap: 25px;
      box-shadow:
        0 8px 26px rgba(0,0,0,0.65),
        inset 0 0 18px rgba(0,0,0,0.9);
      position: relative;
    }

    /* ÏÉÅÎã® ÌÖåÎëêÎ¶¨ */
    .signal-box::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 20px;
      border: 2px solid rgba(255,255,255,0.04);
    }

    /* ==========================
        Î†åÏ¶à Ïú†Îãõ (Ïõê + ÌõÑÎìú)
       ========================== */

    .lamp-unit {
      width: 100%;
      aspect-ratio: 1/1.05;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* ÏÉÅÎã® Í∞ì(ÌõÑÎìú) */
    .lamp-unit::before {
      content: "";
      position: absolute;
      top: -30%;
      left: 10%;
      right: 10%;
      height: 40%;
      background: #15181b;
      border-radius: 16px 16px 6px 6px;
      box-shadow:
        0 6px 14px rgba(0,0,0,0.75),
        inset 0 -2px 6px rgba(0,0,0,0.8);
    }

    /* Î†åÏ¶à(Ïõê) */
    .lamp {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #111;
      box-shadow: inset 0 0 50px rgba(0,0,0,0.9);
      position: relative;
      overflow: hidden;
      transition: 0.25s;
    }

    /* Î†åÏ¶à Î¨¥Îä¨ (grid texture) */
    .lamp::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        repeating-radial-gradient(circle, rgba(255,255,255,0.07) 0 2px, transparent 2px 6px);
      opacity: 0.5;
      mix-blend-mode: screen;
    }

    /* Îπ®Í∞ÑÎ∂à ON */
    .lamp.red.on {
      background: radial-gradient(circle at 30% 30%, #ffdddd, #ff3a3a 60%, #550000 90%);
      box-shadow:
        0 0 32px #ff3b30,
        inset 0 0 50px rgba(0,0,0,0.9);
    }

    /* Ï¥àÎ°ùÎ∂à ON */
    .lamp.green.on {
      background: radial-gradient(circle at 30% 30%, #ddffea, #32ff77 60%, #00441e 90%);
      box-shadow:
        0 0 32px #34c759,
        inset 0 0 50px rgba(0,0,0,0.9);
    }

    /* ==========================
            Í∏∞Îë• + Î∞îÎã•
       ========================== */

    .pole {
      width: 35px;
      height: 260px;
      background: linear-gradient(to right, #222, #555, #222);
      border-radius: 16px;
      box-shadow:
        inset 0 0 18px #111,
        0 6px 16px rgba(0,0,0,0.7);
    }

    .pole-base {
      width: 120px;
      height: 28px;
      background: #333;
      border-radius: 14px;
      box-shadow:
        inset 0 0 14px #111,
        0 4px 10px rgba(0,0,0,0.7);
      margin-top: -4px;
    }

    /* ==========================
               Ï†úÏñ¥ UI
       ========================== */

    .ctrl { width: 100%; max-width: 500px; }

    .btns {
      display: grid;
      gap: 20px;
      margin-top: 20px;
    }

    button {
      padding: 18px;
      font-size: 1.4rem;
      border: none;
      border-radius: 16px;
      color: white;
      background: #444;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .b-red   { background: #e53935; }
    .b-green { background: #2ecc71; }

    .pill {
      background: #0008;
      padding: 10px 14px;
      border-radius: 12px;
      display: inline-block;
      margin-top: 12px;
      color: white;
    }
  </style>

  <!-- ============================
        Firebase & JS Î°úÏßÅ
       ============================ -->
  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyClsKru0-dRRl8ErV5vQx2vS31JFIV_OKM",
      authDomain: "traffic-light-demo-c070a.firebaseapp.com",
      databaseURL: "https://traffic-light-demo-c070a-default-rtdb.firebaseio.com",
      projectId: "traffic-light-demo-c070a",
      storageBucket: "traffic-light-demo-c070a.firebasestorage.app",
      messagingSenderId: "272853805092",
      appId: "1:272853805092:web:e95b87c470419a90d290b1",
      measurementId: "G-ZHQXT1WE0F"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);
    const colorRef = ref(db, "tl/color");

    const params = new URLSearchParams(location.search);
    const mode   = params.get("mode") || "display";

    async function setColor(c){ await set(colorRef, c); }

    async function ensureInit() {
      const s = await get(child(ref(db), "tl/color"));
      if (!s.exists()) await setColor("red");
    }

    // ======================
    //  ÏÑ∏Î°úÌòï Ïã†Ìò∏Îì± ÌôîÎ©¥
    // ======================
    function displayUI() {
      document.querySelector(".wrap").innerHTML = `
        <div class="traffic-vertical">
          <div class="signal-box">

            <div class="lamp-unit">
              <div class="lamp red" id="RED"></div>
            </div>

            <div class="lamp-unit">
              <div class="lamp green" id="GRN"></div>
            </div>

          </div>

          <div class="pole"></div>
          <div class="pole-base"></div>
        </div>
      `;

      onValue(colorRef, snap => {
        const c = snap.val() || "red";
        RED.classList.toggle("on", c === "red");
        GRN.classList.toggle("on", c === "green");
      });
    }

    // ======================
    //  Ï†úÏñ¥ ÌôîÎ©¥
    // ======================
    function controlUI() {
      document.querySelector(".wrap").innerHTML = `
        <div class="ctrl">
          <h2>Ïã†Ìò∏Îì± Ï†úÏñ¥</h2>

          <div class="btns">
            <button class="b-red" id="BRED">üî¥ Îπ®Í∞ÑÎ∂à</button>
            <button class="b-green" id="BGREEN">üü¢ Ï¥àÎ°ùÎ∂à</button>
          </div>

          <div class="pill" id="current">ÌòÑÏû¨: Î°úÎî©Ï§ë‚Ä¶</div>
          <br><br>
          <a href="?mode=display" target="_blank">Ïã†Ìò∏Îì± ÌôîÎ©¥ Ïó¥Í∏∞</a>
        </div>
      `;

      BRED.onclick   = () => setColor("red");
      BGREEN.onclick = () => setColor("green");

      onValue(colorRef, snap => {
        current.textContent = "ÌòÑÏû¨: " + (snap.val() || "red");
      });
    }

    (async ()=>{
      await ensureInit();
      if (mode === "control") controlUI();
      else displayUI();
    })();

  </script>

</head>
<body>
  <div class="wrap"><div>Î°úÎî©Ï§ë‚Ä¶</div></div>
</body>
</html>
